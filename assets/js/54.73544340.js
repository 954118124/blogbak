(window.webpackJsonp=window.webpackJsonp||[]).push([[54],{548:function(t,s,a){"use strict";a.r(s);var n=a(18),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h3",{attrs:{id:"_1-tomcat-主要配置说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-tomcat-主要配置说明"}},[t._v("#")]),t._v(" 1. Tomcat 主要配置说明")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("属性名")]),t._v(" "),a("th",[t._v("说明")]),t._v(" "),a("th",[t._v("默认值")]),t._v(" "),a("th",[t._v("参考值")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("minSpareThreads")]),t._v(" "),a("td",[t._v("最小空闲线程数")]),t._v(" "),a("td",[t._v("10")]),t._v(" "),a("td",[t._v("100")])]),t._v(" "),a("tr",[a("td",[t._v("maxThreads")]),t._v(" "),a("td",[t._v("最大线程数")]),t._v(" "),a("td",[t._v("200")]),t._v(" "),a("td",[t._v("1000")])]),t._v(" "),a("tr",[a("td",[t._v("acceptCount")]),t._v(" "),a("td",[t._v("HTTP请求数达到最大线程数后，新请求被放入等待队列，该值为等待队列的最大等待数，队列一旦满了，后续请求会被tomcat拒绝SocketException: Connection refused")]),t._v(" "),a("td",[t._v("100")]),t._v(" "),a("td",[t._v("1000")])]),t._v(" "),a("tr",[a("td",[t._v("maxConnections")]),t._v(" "),a("td",[t._v("某一时刻，能够接受的最大连接数, maxConnections满了之后一样是将新请求被放入等待队列, 不超过acceptCount")]),t._v(" "),a("td",[t._v("10000")]),t._v(" "),a("td",[t._v("10000")])]),t._v(" "),a("tr",[a("td",[t._v("maxHttpPostSize")]),t._v(" "),a("td",[t._v("请求体最大长度kb")]),t._v(" "),a("td",[t._v("2097152")]),t._v(" "),a("td",[t._v("视情况")])]),t._v(" "),a("tr",[a("td",[t._v("maxHttpHeaderSize")]),t._v(" "),a("td",[t._v("请求头最大长度kb")]),t._v(" "),a("td",[t._v("0")]),t._v(" "),a("td",[t._v("视情况")])])])]),t._v(" "),a("p",[a("strong",[t._v("MaxThreads取值可以按比例推算")])]),t._v(" "),a("p",[t._v("1c2g 200")]),t._v(" "),a("p",[t._v("2c4g 400")]),t._v(" "),a("p",[t._v("4c8g 800")]),t._v(" "),a("p",[t._v("这里取整1000")]),t._v(" "),a("h3",{attrs:{id:"_2-maxthreads-acceptcount-maxconnections三者的关系"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-maxthreads-acceptcount-maxconnections三者的关系"}},[t._v("#")]),t._v(" 2. maxThreads，acceptCount，maxConnections三者的关系")]),t._v(" "),a("ul",[a("li",[t._v("参数maxThreads是指线程池里最大的活跃线程数")]),t._v(" "),a("li",[t._v("参数maxConnections是最大的tcp连接数，而不是最大的Http请求数，通常一个tcp连接可以处理多个http请求")]),t._v(" "),a("li",[t._v("所以，无论maxThreads和maxConnections谁达到了最大值，Tomcat Server都会将后续的Http请求放入队列中，一旦队列满了，后续Http请求会被tomcat拒绝, 从而抛出SocketException: Connection refused异常")]),t._v(" "),a("li",[t._v("按照多路复用模型，一个TCP连接的已连接、可读、可写事件都会交由线程池去分配和处理")]),t._v(" "),a("li",[t._v("所以，所谓达到了maxThreads和maxConnections这两个阈值，只是一个当前值（瞬时值）")]),t._v(" "),a("li",[t._v("线程池的忙闲程度（吞吐量）取决于可读可写操作的耗时（还包括错误率，断连等）")]),t._v(" "),a("li",[t._v("所以，maxThreads>=maxConnections=资源浪费，maxConnections/maxThreads>10=担心它可能处理不过来，需要设置稍大的maxThreads")]),t._v(" "),a("li",[t._v("系统吞吐量的3个指标 rt, cc, qps都达标的情况下，就不需要设置较大的maxThreads，这需要反复压测得出结论")]),t._v(" "),a("li",[t._v("线程池吞吐量上不去，acceptCount设的再大也无济于事，当然应用服务内存足够大，acceptCount设的大也无妨，但是http客户端一旦超时一样会断开")]),t._v(" "),a("li",[t._v("http1.1协议默认都是tcp复用的，一旦超时就会主动断开连接再次重建影响性能，通常浏览器会在一个域名下会建立多个tcp连接提供并发性能")])]),t._v(" "),a("h3",{attrs:{id:"_3-配置文件参考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-配置文件参考"}},[t._v("#")]),t._v(" 3. 配置文件参考")]),t._v(" "),a("div",{staticClass:"language-YAML line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tomcat")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uri-encoding")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" UTF"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#初始化线程数")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("min-spare-threads")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#最大线程数")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("max-threads")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#最大链接数")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("max-connections")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10000")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#最大等待队列长度")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("accept-count")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#请求头最大长度kb")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# max-http-header-size: 1048576")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#请请求体最大长度kb")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# max-http-post-size: 2097152")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#服务http端口")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#链接建立超时时间")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("connection-timeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10000")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("servlet")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#访问根路径")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("context-path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /test\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br")])])])}),[],!1,null,null,null);s.default=e.exports}}]);