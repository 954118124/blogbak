<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>分布式 | Louis&#39;s Blog</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/img/star.png">
    <meta name="description" content="专注后端技术">
    <meta name="keywords" content="后端博客,个人技术博客,技术文档,学习,Java,mysql,ES,Oracle,K8S,jenkins,docker,jvm,spring cloud,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.daeec4d3.css" as="style"><link rel="preload" href="/assets/js/app.7948fbd5.js" as="script"><link rel="preload" href="/assets/js/2.03b28187.js" as="script"><link rel="preload" href="/assets/js/22.aba0c823.js" as="script"><link rel="prefetch" href="/assets/js/10.b85486db.js"><link rel="prefetch" href="/assets/js/11.6fbe697f.js"><link rel="prefetch" href="/assets/js/12.eddb137b.js"><link rel="prefetch" href="/assets/js/13.70c3219b.js"><link rel="prefetch" href="/assets/js/14.2ce903a1.js"><link rel="prefetch" href="/assets/js/15.f6d5a48a.js"><link rel="prefetch" href="/assets/js/16.a51979d6.js"><link rel="prefetch" href="/assets/js/17.052c7d71.js"><link rel="prefetch" href="/assets/js/18.c5197d8b.js"><link rel="prefetch" href="/assets/js/19.31eee7f4.js"><link rel="prefetch" href="/assets/js/20.40425150.js"><link rel="prefetch" href="/assets/js/21.20f30b4c.js"><link rel="prefetch" href="/assets/js/23.0a1cabb8.js"><link rel="prefetch" href="/assets/js/24.21e0a2af.js"><link rel="prefetch" href="/assets/js/25.9aa3c7a1.js"><link rel="prefetch" href="/assets/js/26.dc0a291e.js"><link rel="prefetch" href="/assets/js/27.1fb50a48.js"><link rel="prefetch" href="/assets/js/28.5180da38.js"><link rel="prefetch" href="/assets/js/29.2c1fc28c.js"><link rel="prefetch" href="/assets/js/3.eab3bf47.js"><link rel="prefetch" href="/assets/js/30.a206b18b.js"><link rel="prefetch" href="/assets/js/31.eb5d63b1.js"><link rel="prefetch" href="/assets/js/32.60c8e130.js"><link rel="prefetch" href="/assets/js/33.7a6feeca.js"><link rel="prefetch" href="/assets/js/34.6293336a.js"><link rel="prefetch" href="/assets/js/35.573bbc7e.js"><link rel="prefetch" href="/assets/js/36.fc3ad798.js"><link rel="prefetch" href="/assets/js/37.739a3bee.js"><link rel="prefetch" href="/assets/js/38.3bd68f60.js"><link rel="prefetch" href="/assets/js/39.3a8968ef.js"><link rel="prefetch" href="/assets/js/4.e28bfee5.js"><link rel="prefetch" href="/assets/js/40.d91c4d81.js"><link rel="prefetch" href="/assets/js/41.c8853fda.js"><link rel="prefetch" href="/assets/js/42.93b78ece.js"><link rel="prefetch" href="/assets/js/43.099a05dc.js"><link rel="prefetch" href="/assets/js/44.75d8b815.js"><link rel="prefetch" href="/assets/js/45.5921481d.js"><link rel="prefetch" href="/assets/js/46.2f346468.js"><link rel="prefetch" href="/assets/js/47.d05c6a0f.js"><link rel="prefetch" href="/assets/js/48.0c04a438.js"><link rel="prefetch" href="/assets/js/49.1985e5d4.js"><link rel="prefetch" href="/assets/js/5.bc3ec4c9.js"><link rel="prefetch" href="/assets/js/6.0483b1f8.js"><link rel="prefetch" href="/assets/js/7.d647dee4.js"><link rel="prefetch" href="/assets/js/8.cb68ffb3.js"><link rel="prefetch" href="/assets/js/9.9c6e3b96.js">
    <link rel="stylesheet" href="/assets/css/0.styles.daeec4d3.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/star.png" alt="Louis's Blog" class="logo"> <span class="site-name can-hide">Louis's Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/pages/8611ff/" class="nav-link">知识整理</a></div><div class="nav-item"><a href="/pages/6e6e98/" class="nav-link">技术应用</a></div><div class="nav-item"><a href="/pages/c486c7/" class="nav-link">流程规范</a></div><div class="nav-item"><a href="/friends/" class="nav-link">友情链接</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/01-luoxiaofeng.jpeg"> <div class="blogger-info"><h3>Louis</h3> <span></span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/pages/8611ff/" class="nav-link">知识整理</a></div><div class="nav-item"><a href="/pages/6e6e98/" class="nav-link">技术应用</a></div><div class="nav-item"><a href="/pages/c486c7/" class="nav-link">流程规范</a></div><div class="nav-item"><a href="/friends/" class="nav-link">友情链接</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>中间件</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>持久化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>网络</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>系统架构</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/c0fe60/" aria-current="page" class="active sidebar-link">分布式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/c0fe60/#_4、cap理论-eureka与zookeeper区别" class="sidebar-link">4、CAP理论，Eureka与Zookeeper区别？</a></li><li class="sidebar-sub-header level2"><a href="/pages/c0fe60/#_5、soa和微服务架构的区别" class="sidebar-link">5、SOA和微服务架构的区别？</a></li></ul></li><li><a href="/pages/427643/" class="sidebar-link">系统架构设计</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-1baff76c><div class="articleInfo" data-v-1baff76c><ul class="breadcrumbs" data-v-1baff76c><li data-v-1baff76c><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-1baff76c></a></li> <li data-v-1baff76c><a href="/categories/?category=%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0" title="分类" data-v-1baff76c>学习笔记</a></li><li data-v-1baff76c><a href="/categories/?category=%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84" title="分类" data-v-1baff76c>系统架构</a></li></ul> <div class="info" data-v-1baff76c><div title="作者" class="author iconfont icon-touxiang" data-v-1baff76c><a href="javascript:;" data-v-1baff76c>luoxiaofeng</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-1baff76c><a href="javascript:;" data-v-1baff76c>2022-04-28</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">分布式<!----></h1>  <div class="theme-vdoing-content content__default"><h1 id="分布式"><a href="#分布式" class="header-anchor">#</a> 分布式</h1> <h3 id="_1、谈谈-rpc-的工作过程"><a href="#_1、谈谈-rpc-的工作过程" class="header-anchor">#</a> 1、谈谈 RPC 的工作过程</h3> <p>RPC(Remote Procedure Call)即远程过程调用，允许一台计算机调用另一台计算机上的程序得到结果，而代码中不需要做额外的编程，就像在本地调用一样。</p> <p>现在互联网应用的量级越来越大，单台计算机的能力有限，需要借助可扩展的计算机集群来完成，分布式的应用可以借助RPC来完成机器之间的调用。</p> <p><strong>在RPC框架中主要有三个角色：Provider、Consumer和Registry。如下图所示：</strong></p> <p><strong><img src="/img/media/90f0ea4d5cb045235d28b7623fd99388.png" width="70%" class="imgcss"></strong></p> <p><strong>RPC调用流程:</strong></p> <p>1）服务消费方（client）调用以本地调用方式调用服务；</p> <p>2）client stub接收到调用后负责将方法、参数等组装成能够进行网络传输的消息体；</p> <p>3）client stub找到服务地址，并将消息发送到服务端；</p> <p>4）server stub收到消息后进行解码；</p> <p>5）server stub根据解码结果调用本地的服务；</p> <p>6）本地服务执行并将结果返回给server stub；</p> <p>7）server stub将返回结果打包成消息并发送至消费方；</p> <p>8）client stub接收到消息，并进行解码；</p> <p>9）服务消费方得到最终结果。</p> <h3 id="_2、雪花算法"><a href="#_2、雪花算法" class="header-anchor">#</a> 2、雪花算法</h3> <img src="/img/media/7d195b460df37819cc0951b8ba616850.png" width="70%" class="imgcss"> <p><strong>41bit时间戳</strong>：这里采用的就是当前系统的具体时间，单位为毫秒。</p> <p><strong>10bit工作机器ID（workerId）</strong>：每台机器分配一个id，标示不同的机器，上限1024，标示一个集群某个业务最多部署的机器个数上限。</p> <p><strong>12bit序列号（自增域）</strong>：表示在某一毫秒下，这个自增域最大可以分配的bit个数，在当前这种配置下，每一毫秒可以分配2^12个数据，也就是说QPS可以到 409.6 w/s。</p> <p><strong>存在问题</strong></p> <p><strong>时间回拨问题</strong>：由于机器的时间是动态的调整的，有可能会出现时间跑到之前几毫秒，如果这个时候获取到了这种时间，则会出现数据重复。</p> <p><strong>机器id分配及回收问题</strong>：目前机器id需要每台机器不一样，这样的方式分配需要有方案进行处理，同时也要考虑，如果改机器宕机了，对应的workerId分配后的回收问题。</p> <p><strong>机器id上限</strong>：机器id是固定的bit，那么也就是对应的机器个数是有上限的，在有些业务场景下，需要所有机器共享同一个业务空间，那么10bit表示的1024台机器是不够的。</p> <h3 id="_3、什么是跨域-跨域问题怎么解决"><a href="#_3、什么是跨域-跨域问题怎么解决" class="header-anchor">#</a> 3、什么是跨域？跨域问题怎么解决？</h3> <p><strong>协议、域名、端口号有一个不一样就是跨域。</strong></p> <p>跨域：跨域访问，简单来说就是A网站的javascript代码试图访问B网站，包括提交内容和获取内容。由于安全原因，跨域访问是被各大浏览器所默认禁止的。</p> <p>目前我了解的解决跨域的几种方式：</p> <p>1）手写过滤器</p> <p>2）手写拦截器</p> <p>3）jsonp</p> <p>4）注解方式</p> <p>5）配置nginx反向代理</p> <p>共五种解决方式。</p> <img src="/img/media/6714d5192ceaa816e704eed122a93b96.png" width="70%" class="imgcss"> <img src="/img/media/f8d34608217bb7be83e7050cac872b28.png" width="70%" class="imgcss"> <h2 id="_4、cap理论-eureka与zookeeper区别"><a href="#_4、cap理论-eureka与zookeeper区别" class="header-anchor">#</a> 4、CAP理论，Eureka与Zookeeper区别？</h2> <p><strong>著名的CAP理论指出，一个分布式系统不可能同时满足C(一致性Consistency)、A(可用性Availability)和P(分区容错性Partition tolerance)。<br>
由于分区容错性在是分布式系统中必须要保证的，因此我们只能在A和C之间进行权衡。</strong><br>
在此Zookeeper保证的是CP, 而Eureka则是AP。<br>
1）当向注册中心查询服务列表时，我们可以容忍注册中心返回的是几分钟以前的注册信息，但不能接受服务直接down掉不可用。也就是说，服务注册功能对可用性的要求要高于一致性。<br>
但是zk会出现这样一种情况，当master节点因为网络故障与其他节点失去联系时，剩余节点会重新进行leader选举。<br>
问题在于，选举leader的时间太长，30 ~ 120s, 且选举期间整个zk集群都是不可用的，这就导致在选举期间注册服务瘫痪。<br>
2）Eureka各个节点都是平等的，几个节点挂掉不会影响正常节点的工作，剩余的节点依然可以提供注册和查询服务。<br>
而Eureka的客户端在向某个Eureka注册或时如果发现连接失败，则会自动切换至其它节点，只要有一台Eureka还在，就能保证注册服务可用(保证可用性)，只不过查到的信息可能不是最新的(不保证强一致性)。</p> <h2 id="_5、soa和微服务架构的区别"><a href="#_5、soa和微服务架构的区别" class="header-anchor">#</a> 5、SOA和微服务架构的区别？</h2> <p>SOA (全称:Service Oriented Architecture)</p> <p><strong>一、架构划分不同</strong></p> <p>1、SOA强调按水平架构划分为：前、后端、数据库、测试等；</p> <p>2、微服务强调按垂直架构划分，按业务能力划分，每个服务完成一种特定的功能，服务即产品。</p> <p><strong>二、技术平台选择不同</strong></p> <p>1、SOA应用倾向于使用统一的技术平台来解决所有问题；</p> <p>2、微服务可以针对不同业务特征选择不同技术平台，去中心统一化，发挥各种技术平台的特长。</p> <p><strong>三、系统间边界处理机制不同</strong></p> <p>1、SOA架构强调的是异构系统之间的通信和解耦合；（一种粗粒度、松耦合的服务架构）；</p> <p>2、微服务架构强调的是系统按业务边界做细粒度的拆分和部署。</p> <p><strong>四、主要目标不同</strong></p> <p>1、SOA架构，主要目标是确保应用能够交互操作；</p> <p>2、微服务架构，主要目标是实现新功能、并可以快速拓展开发团队。</p></div></div>  <div class="page-edit"><!----> <div class="tags"><a href="/tags/?tag=%E5%88%86%E5%B8%83%E5%BC%8F" title="标签">#分布式</a></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">5/6/2022, 10:50:52 PM</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/451590/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">网络</div></a> <a href="/pages/427643/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">系统架构设计</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/451590/" class="prev">网络</a></span> <span class="next"><a href="/pages/427643/">系统架构设计</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/136ae8/"><div>
            多线程
            <!----></div></a> <span class="date">05-06</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/745032/"><div>
            并发加锁
            <!----></div></a> <span class="date">05-06</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/a27f33/"><div>
            数据结构
            <!----></div></a> <span class="date">05-06</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><!----> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> <!----></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.7948fbd5.js" defer></script><script src="/assets/js/2.03b28187.js" defer></script><script src="/assets/js/22.aba0c823.js" defer></script>
  </body>
</html>
